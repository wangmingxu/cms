angular.module("starter.controllers",[]).controller("navCtrl",function(e,t,i,a){$(document).on("click",".nav_item li",function(e){e.preventDefault(),$(".nav_item li").removeClass("active"),$(e.currentTarget).addClass("active")})}).controller("planEntranceCtrl",function(e,t,i,a){e.enterAdvPlan=function(){i.path("tab/planList/1")},e.enterArticlePlan=function(){i.path("tab/planList/2")}}).controller("planListCtrl",function(e,t,i,a,n){e.planType=n.planType,e.toAddPlan=function(){i.path("tab/addPlanStep1/"+e.planType)},e.delPlan=function(i){var n=a+"cms/showPlan/delete/showPlan";t({method:"GET",url:n,params:{showPlanId:i}}).then(function(t,i,a,n){e.getPlan()},function(e,t,i,a){})},e.online=function(i){var n=a+"cms/showPlan/immediatelyOnline";t({method:"GET",url:n}).then(function(t,i,a,n){e.getPlan()},function(e,t,i,a){})},e.stop=function(i){var n=a+"cms/showPlan/pause/showPlan";t({method:"GET",url:n,params:{showPlanId:i}}).then(function(t,i,a,n){e.getPlan()},function(e,t,i,a){})},e.getPlan=function(){var i=a+"cms/showPlan/query/showPlans";t({method:"GET",url:i}).then(function(t,i,a,n){e.list=t.data.model.showPlanRowVOList,e.totalSize=t.data.model.totalSize},function(e,t,i,a){})},e.getPlan()}).controller("picMaterialCtrl",function(e,t,i,a,n,c,r){e.getPicList=function(){var i=a+"cms/material/query/materials";t({method:"GET",url:i,params:{materialType:1}}).then(function(t,i,a,n){e.list=t.data.model.materialDTOList},function(e,t,i,a){})},e.getPicList(),e.delMaterial=function(i){var n=a+"cms/material/delete/material";t({method:"GET",url:n,params:{materialId:i}}).then(function(t,i,a,n){e.getPicList()},function(e,t,i,a){})},e.preview=function(t){e.picPreviewUrl=r+t}}).controller("articleMaterialCtrl",function(e,t,i,a,n,c){e.getArticleList=function(){var i=a+"cms/material/query/materials";t({method:"GET",url:i,params:{materialType:2}}).then(function(t,i,a,n){e.list=t.data.model.materialDTOList},function(e,t,i,a){})},e.getArticleList(),e.delMaterial=function(i){var n=a+"cms/material/delete/material";t({method:"GET",url:n,params:{materialId:i}}).then(function(t,i,a,n){e.getArticleList()},function(e,t,i,a){})}}).controller("addPlanStep1Ctrl",function(e,t,i,a,n,c,r,l){e.start_time=new Date,e.end_time=new Date,e.planType=l.planType,window.cache&&(e.planName=cache.get("planName"),e.start_time=cache.get("start_time"),e.end_time=cache.get("end_time"),e.planType=cache.get("planType"),e.priority=cache.get("priority"),e.admin_isSelect=JSON.parse(cache.get("admin_isSelect")),e.serviceArea_selectIndex=JSON.parse(cache.get("serviceArea_selectIndex")),e.serviceArea_isSelect=JSON.parse(cache.get("serviceArea_isSelect")));var o=a+"cms/showPlan/allRegion";t({method:"GET",cache:!0,url:o}).then(function(t,i,a,n){e.administration_area=t.data.model.provinceDTOList,e.service_area=t.data.model.serviceAreaVOList},function(e,t,i,a){}),e.cacheIpt=function(t){var i=JSON.stringify(e.admin_isSelect),a=JSON.stringify(e.serviceArea_selectIndex),n=JSON.stringify(e.serviceArea_isSelect);t.put("planName",e.planName),t.put("start_time",e.start_time),t.put("end_time",e.end_time),t.put("planType",e.planType),t.put("priority",e.priority),t.put("admin_isSelect",i),t.put("serviceArea_selectIndex",a),t.put("serviceArea_isSelect",n),t.put("hasAllowNotLimited",e.hasAllowNotLimited)},e.toStep2=function(){window.cache?(cache.removeAll(),e.cacheIpt(cache),c.go("tab.planEntrance.addPlanStep2")):(window.cache=n("addPlan"),e.cacheIpt(cache),c.go("tab.planEntrance.addPlanStep2"))},e.tabAdmin=function(){e.inServiceTab=!1,e.inAdminTab=!0},e.tabService=function(){e.inServiceTab=!0,e.inAdminTab=!1},e.tabAdmin(),e.admin_isSelect=[],e.serviceArea_selectIndex=[],e.select_item=function(t){var i=e.admin_isSelect.indexOf(e.administration_area[t].provinceID);i==-1?e.admin_isSelect.push(e.administration_area[t].provinceID):e.admin_isSelect.splice(i,1)},e.AreaClass=function(t){var i=e.admin_isSelect.indexOf(e.administration_area[t].provinceID);if(i!=-1)return"area_name_active"},e.ensure_area=function(){},e.cancel=function(){e.admin_isSelect=[],e.serviceArea_selectIndex=[],e.serviceArea_isSelect=[]},e.adminAreaName_select=function(t){var i=e.admin_isSelect.indexOf(t);return i!=-1},e.del_adminArea=function(t){var i=e.admin_isSelect.indexOf(t);e.admin_isSelect.splice(i,1)},e.del_serviceArea=function(t){e.serviceArea_selectIndex[t]=!1},e.$watch("serviceArea_selectIndex",function(){e.serviceArea_isSelect=[],e.serviceArea_selectIndex.map(function(t,i){t&&e.serviceArea_isSelect.push(e.service_area[i].provinceId)})},!0),e.serviceAreaName_select=function(t){var i=e.serviceArea_isSelect.indexOf(t);return i!=-1}}).controller("addPlanStep2Ctrl",function(e,t,i,a,n,c,r,l,o){e.picUrl=o,e.planName=cache.get("planName"),e.start_time=r("date")(cache.get("start_time"),"yyyy-MM-dd"),e.end_time=r("date")(cache.get("end_time"),"yyyy-MM-dd"),e.planType=cache.get("planType"),e.priority=cache.get("priority"),e.admin_isSelect=JSON.parse(cache.get("admin_isSelect")),e.serviceArea_isSelect=JSON.parse(cache.get("serviceArea_isSelect")),e.hasAllowNotLimited=cache.get("hasAllowNotLimited"),e.getAdvResource=function(){e.checked_resource=[];var i=a+"cms/resource/advertisement/resources";t({method:"GET",url:i}).then(function(t,i,a,n){e.resourceList=t.data.model.resourcePositionDTOList},function(e,t,i,a){})},e.resource_ensure=function(){e.resourceList.map(function(t,i){t.isChecked&&(t.picIdArr=[],t.picObjArr=[],e.checked_resource.push(t))})},e.getPic=function(i,n){var c=a+"cms/material/query/materials";e.pageSize=20;var r;switch(n){case"next":r=e.cur_pageIndex+1;break;case"prev":r=e.cur_pageIndex-1;break;default:r=1}e.temp_resIndex=i,t({method:"GET",url:c,params:{materialType:1,pageIndex:e.cur_pageIndex,pageSize:e.pageSize}}).then(function(t,i,a,n){var c=t.data.model.materialDTOList;e.totalSize=t.data.model.totalSize,e.cur_pageIndex=r,e.temp_picList=angular.copy(c)},function(e,t,i,a){})},e.del_resource=function(t){e.checked_resource.splice(t,1)},e.select_pic=function(t,i){var a=e.checked_resource[e.temp_resIndex].picIdArr.indexOf(t);a==-1?(e.checked_resource[e.temp_resIndex].picIdArr.push(t),e.checked_resource[e.temp_resIndex].picObjArr.push(i)):(e.checked_resource[e.temp_resIndex].picIdArr.splice(a,1),e.checked_resource[e.temp_resIndex].picObjArr.splice(a,1))},e.SelectClass=function(t){var i=e.checked_resource[e.temp_resIndex].picIdArr.indexOf(t);if(i!=-1)return"material_item_active"},e.judge_hasSelect=function(t){var i=0;return i=e.checked_resource[t].picIdArr.length,i>0},e.disableFinish=function(){var t=!1;try{e.checked_resource.map(function(e,i){0===e.picIdArr.length&&(t=!0)})}catch(i){t=!0}return t},e.pic_next=function(t){void 0!==t&&(e.temp_resIndex=t),$("#selectPic_Modal").modal("hide"),$("#editPic_Modal").modal("show")},e.del_SelectPic=function(t){e.checked_resource[e.temp_resIndex].picObjArr.splice(t,1),e.checked_resource[e.temp_resIndex].picIdArr.splice(t,1)},e.swapItems=function(e,t,i,a){e[i]=e.splice(a,1,e[i])[0],t[i]=t.splice(a,1,t[i])[0]},e.move_up=function(t,i,a){0!==a&&e.swapItems(t,i,a,a-1)},e.move_down=function(t,i,a){a!=t.length-1&&e.swapItems(t,i,a,a+1)},e.picSelect_finish=function(){console.log(e.checked_resource)},e.picPlan_finish=function(){e.resourcePositionMaterialReleaseVOList=[],e.checked_resource.map(function(t,i){var a={};a.resourcePositionId=t.resourcePositionId,a.materialIdList=t.picIdArr,e.resourcePositionMaterialReleaseVOList.push(a)});var n={showPlanName:e.planName,showPlanType:e.planType,displayBeginTime:e.start_time,displayEndTime:e.end_time,priority:e.priority,provinceIdListByAdministrative:e.admin_isSelect,provinceIdListByServiceArea:e.serviceArea_isSelect,resourcePositionMaterialReleaseVOList:e.resourcePositionMaterialReleaseVOList,hasAllowNotLimited:e.hasAllowNotLimited};console.log(n);var c=a+"cms/showPlan/release";t({method:"POST",url:c,data:n}).then(function(e,t,a,n){e.data.success&&(cache.removeAll(),$("#addPlanSuccess").modal("show"),l(function(){$("#addPlanSuccess").modal("hide"),l(function(){i.path("tab/planList/1")},800)},800))},function(e,t,i,a){$("#addPlanFail").modal("show"),l(function(){$("#addPlanFail").modal("hide")},800)})},e.getArticle=function(){var i=a+"cms/material/query/materials";Mock.mock(i,{"list|1-10":[{"id|+1":1,"meterialName|1":["注册与审核","用户登录","用户注册"],previewUrl:"https://www.baidu.com/img/baidu_jgylogo3.gif"}]}),t({method:"GET",url:i,params:{materialType:2}}).then(function(t,i,a,n){e.articleList=t.data.list},function(e,t,i,a){})},e.article_ensure=function(){},e.back=function(){n.go("tab.planEntrance.addPlanStep1")}}).controller("uploadpicCtrl",function(e,t,i,a,n){e.picList=[],e.delPic=function(t){e.picList.splice(t,1)},e.$watch("picList",function(){e.restCount=6-e.picList.length},!0),e.upload=function(){for(var t=new FormData,i=0;i<e.picList.length;i++)t.append("file"+i,e.picList[i].file),t.append("materialNameList",e.picList[i].title);t.append("targetUrl",e.targetUrl);var c=a+"cms/material/upload/pictures";$.ajax({url:c,type:"POST",data:t,async:!1,cache:!1,contentType:!1,processData:!1}).done(function(){$("#uploadFinish").modal("show"),n(function(){$("#uploadFinish").modal("hide")},800)}).fail(function(){$("#uploadFail").modal("show"),n(function(){$("#uploadFail").modal("hide")},800)})}}).controller("createArticleCtrl",function(e,t,i,a){UE.getEditor("editor");e.getContent=function(){var e=[],t=UE.getEditor("editor").getContent();return e.push("使用editor.getContent()方法可以获得编辑器的内容"),e.push("内容为："),e.push(t),t}}).controller("advResourceCtrl",function(e,t,i,a,n){e.platform=n.platform;var c=a+"cms/resource/advertisement/resources";t({method:"GET",url:c}).then(function(t,i,a,n){e.list=t.data.model.resourcePositionDTOList},function(e,t,i,a){})}).controller("articleResourceCtrl",function(e,t,i,a,n){});
angular.module("starter.controllers",[]).controller("navCtrl",function(e,t,i,a){$(document).on("click",".nav_item li",function(e){e.preventDefault(),$(".nav_item li").removeClass("active"),$(e.currentTarget).addClass("active")})}).controller("planEntranceCtrl",function(e,t,i,a){e.enterAdvPlan=function(){i.path("tab/planList/1")},e.enterArticlePlan=function(){i.path("tab/planList/2")}}).controller("planListCtrl",function(e,t,i,a,n){e.planType=n.planType,e.toAddPlan=function(){i.path("tab/addPlanStep1/"+e.planType)},e.delPlan=function(i){var n=a+"cms/showPlan/delete/showPlan";t({method:"GET",url:n,params:{showPlanId:i}}).then(function(t,i,a,n){console.log(t),e.getPlan()},function(e,t,i,a){})},e.online=function(i){var n=a+"cms/showPlan/immediatelyOnline";t({method:"GET",url:n}).then(function(t,i,a,n){console.log(t),e.getPlan()},function(e,t,i,a){})},e.getPlan=function(){var i=a+"cms/showPlan/query/showPlans";t({method:"GET",url:i}).then(function(t,i,a,n){e.list=t.data.model.showPlanRowVOList,e.totalSize=t.data.model.totalSize},function(e,t,i,a){console.log(e)})},e.getPlan()}).controller("picMaterialCtrl",function(e,t,i,a,n,c){e.getPicList=function(){var i=a+"cms/material/query/materials";t({method:"GET",url:i,params:{materialType:1}}).then(function(t,i,a,n){console.log(t.data),e.list=t.data.model.materialDTOList},function(e,t,i,a){console.log(e)})},e.getPicList(),e.delMaterial=function(i){var n=a+"cms/material/delete/material";t({method:"GET",url:n,params:{materialId:i}}).then(function(t,i,a,n){console.log(t),e.getPicList()},function(e,t,i,a){console.log(e)})},e.preview=function(t){e.picPreviewUrl=a+t}}).controller("articleMaterialCtrl",function(e,t,i,a,n,c){e.getArticleList=function(){var i=a+"cms/material/query/materials";t({method:"GET",url:i,params:{materialType:2}}).then(function(t,i,a,n){console.log(t.data),e.list=t.data.model.materialDTOList},function(e,t,i,a){console.log(e)})},e.getArticleList(),e.delMaterial=function(i){var n=a+"cms/material/delete/material";t({method:"GET",url:n,params:{materialId:i}}).then(function(t,i,a,n){console.log(t),e.getArticleList()},function(e,t,i,a){console.log(e)})}}).controller("addPlanStep1Ctrl",function(e,t,i,a,n,c,o,l){e.start_time=new Date,e.end_time=new Date,e.planType=l.planType,window.cache&&(console.log("存在缓存"),e.planName=cache.get("planName"),e.start_time=cache.get("start_time"),e.end_time=cache.get("end_time"),e.planType=cache.get("planType"),e.priority=cache.get("priority"),e.admin_isSelect=JSON.parse(cache.get("admin_isSelect")),e.serviceArea_selectIndex=JSON.parse(cache.get("serviceArea_selectIndex")),e.serviceArea_isSelect=JSON.parse(cache.get("serviceArea_isSelect")));var r=a+"cms/showPlan/allRegion";t({method:"GET",url:r}).then(function(t,i,a,n){console.log(t.data),e.administration_area=t.data.model.provinceDTOList,e.service_area=t.data.model.serviceAreaVOList},function(e,t,i,a){console.log(e)}),e.cacheIpt=function(t){var i=JSON.stringify(e.admin_isSelect),a=JSON.stringify(e.serviceArea_selectIndex),n=JSON.stringify(e.serviceArea_isSelect);t.put("planName",e.planName),t.put("start_time",e.start_time),t.put("end_time",e.end_time),t.put("planType",e.planType),t.put("priority",e.priority),t.put("admin_isSelect",i),t.put("serviceArea_selectIndex",a),t.put("serviceArea_isSelect",n)},e.toStep2=function(){window.cache?(cache.removeAll(),e.cacheIpt(cache),c.go("tab.planEntrance.addPlanStep2")):(window.cache=n("addPlan"),e.cacheIpt(cache),c.go("tab.planEntrance.addPlanStep2"))},e.admin_isSelect=[],e.serviceArea_selectIndex=[],e.select_item=function(t){var i=e.admin_isSelect.indexOf(e.administration_area[t].provinceID);i==-1?e.admin_isSelect.push(e.administration_area[t].provinceID):e.admin_isSelect.splice(i,1)},e.AreaClass=function(t){var i=e.admin_isSelect.indexOf(e.administration_area[t].provinceID);if(i!=-1)return"area_name_active"},e.ensure_area=function(){console.log(e.serviceArea_isSelect)},e.cancel=function(){e.admin_isSelect=[],e.serviceArea_selectIndex=[],e.serviceArea_isSelect=[]},e.adminAreaName_select=function(t){var i=e.admin_isSelect.indexOf(t);return i!=-1},e.del_adminArea=function(t){var i=e.admin_isSelect.indexOf(t);e.admin_isSelect.splice(i,1)},e.del_serviceArea=function(t){e.serviceArea_selectIndex[t]=!1},e.$watch("serviceArea_selectIndex",function(){e.serviceArea_isSelect=[],e.serviceArea_selectIndex.map(function(t,i){t&&e.serviceArea_isSelect.push(e.service_area[i].provinceId)})},!0),e.serviceAreaName_select=function(t){var i=e.serviceArea_isSelect.indexOf(t);return i!=-1}}).controller("addPlanStep2Ctrl",function(e,t,i,a,n,c,o,l){e.prefix=a,e.planName=cache.get("planName"),e.start_time=o("date")(cache.get("start_time"),"yyyy-MM-dd"),e.end_time=o("date")(cache.get("end_time"),"yyyy-MM-dd"),e.planType=cache.get("planType"),e.priority=cache.get("priority"),e.admin_isSelect=JSON.parse(cache.get("admin_isSelect")),e.serviceArea_isSelect=JSON.parse(cache.get("serviceArea_isSelect")),e.getPic=function(){var i=a+"cms/material/query/materials?materialType=1";t({method:"GET",url:i}).then(function(t,i,a,n){e.picList=t.data.model.materialDTOList,console.log(e.picList)},function(e,t,i,a){console.log(e)})},e.getPic(),e.getAdvResource=function(){e.checked_resource=[];var i=a+"cms/resource/advertisement/resources";t({method:"GET",url:i}).then(function(t,i,a,n){console.log(t.data),e.resourceList=t.data.model.resourcePositionDTOList},function(e,t,i,a){console.log(e)})},e.resource_ensure=function(){e.resourceList.map(function(t,i){t.isChecked&&(t.picList=angular.copy(e.picList),e.checked_resource.push(t))})},e.show_picList=function(t){e.temp_index=t,e.temp_picList=e.checked_resource[t].picList},e.del_resource=function(t){e.checked_resource.splice(t,1)},e.select_pic=function(t){e.temp_picList[t].isSelect?e.temp_picList[t].isSelect=!1:e.temp_picList[t].isSelect=!0},e.SelectClass=function(t){if(e.temp_picList[t].isSelect)return"material_item_active"},e.judge_hasSelect=function(t){var i=0;return e.checked_resource[t].picList.map(function(e,t){e.isSelect&&i++}),i>0},e.pic_next=function(t){e.temp_picList_next=[];void 0!==t&&(e.temp_index=t),e.checked_resource[e.temp_index].picList.map(function(t,i){t.isSelect&&e.temp_picList_next.push(t)}),t?$("#editPic_Modal").modal("show"):($("#selectPic_Modal").modal("hide"),$("#editPic_Modal").modal("show"))},e.del_SelectPic=function(t){e.temp_picList_next.splice(t,1)},e.swapItems=function(e,t,i){return e[t]=e.splice(i,1,e[t])[0],e},e.move_up=function(t,i){0!==i&&e.swapItems(t,i,i-1)},e.move_down=function(t,i){i!=t.length-1&&e.swapItems(t,i,i+1)},e.picSelect_finish=function(){var t=e.temp_index;e.checked_resource[t].picList=angular.copy(e.temp_picList_next),console.log(e.checked_resource)},e.picPlan_finish=function(){console.log(e.checked_resource),e.resourcePositionMaterialReleaseVOList=[],e.checked_resource.map(function(t,i){var a={};a.resourcePositionId=t.resourcePositionId,a.materialIdList=[],t.picList.map(function(e,t){a.materialIdList.push(e.materialId)}),e.resourcePositionMaterialReleaseVOList.push(a)}),console.log(e.resourcePositionMaterialReleaseVOList);var i={showPlanName:e.planName,showPlanType:e.planType,displayBeginTime:e.start_time,displayEndTime:e.end_time,priority:e.priority,provinceIdListByAdministrative:e.admin_isSelect,provinceIdListByServiceArea:e.serviceArea_isSelect,resourcePositionMaterialReleaseVOList:e.resourcePositionMaterialReleaseVOList};console.log(i);var n=a+"cms/showPlan/release";t({method:"POST",url:n,data:i}).then(function(e,t,i,a){console.log(e.data),e.data.success&&($("#addPlanSuccess").modal("show"),l(function(){$("#addPlanSuccess").modal("hide")},800))},function(e,t,i,a){console.log(e),$("#addPlanFail").modal("show"),l(function(){$("#addPlanFail").modal("hide")},800)})},e.getArticle=function(){var i=a+"cms/material/query/materials?materialType=2";Mock.mock(i,{"list|1-10":[{"id|+1":1,"meterialName|1":["注册与审核","用户登录","用户注册"],previewUrl:"https://www.baidu.com/img/baidu_jgylogo3.gif"}]}),t({method:"GET",url:i}).then(function(t,i,a,n){e.articleList=t.data.list,console.log(e.articleList)},function(e,t,i,a){console.log(e)})},e.article_ensure=function(){console.log(e.articleList)},e.back=function(){n.go("tab.planEntrance.addPlanStep1")}}).controller("uploadpicCtrl",function(e,t,i,a,n){e.picList=[],e.delPic=function(t){e.picList.splice(t,1)},e.$watch("picList",function(){e.restCount=6-e.picList.length},!0),e.upload=function(){for(var t=new FormData,i=0;i<e.picList.length;i++)t.append("file"+i,e.picList[i].file),t.append("materialNameList",e.picList[i].title);t.append("targetUrl",e.targetUrl);var c=a+"cms/material/upload/pictures";$.ajax({url:c,type:"POST",data:t,async:!1,cache:!1,contentType:!1,processData:!1}).done(function(){$("#uploadFinish").modal("show"),n(function(){$("#uploadFinish").modal("hide")},800)}).fail(function(){$("#uploadFail").modal("show"),n(function(){$("#uploadFail").modal("hide")},800)})}}).controller("createArticleCtrl",function(e,t,i,a){UE.getEditor("editor");e.getContent=function(){var e=[],t=UE.getEditor("editor").getContent();return e.push("使用editor.getContent()方法可以获得编辑器的内容"),e.push("内容为："),e.push(t),console.log(e.join("\n")),t}}).controller("advResourceCtrl",function(e,t,i,a,n){e.platform=n.platform;var c=a+"cms/resource/advertisement/resources";t({method:"GET",url:c}).then(function(t,i,a,n){console.log(t.data),e.list=t.data.model.resourcePositionDTOList},function(e,t,i,a){console.log(e)})}).controller("articleResourceCtrl",function(e,t,i,a,n){});